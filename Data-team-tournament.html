<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Team Leaderboard</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f72585;
            --gold: #FFD700;
            --silver: #C0C0C0;
            --bronze: #CD7F32;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease;
        }

        h1 {
            color: var(--dark);
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--primary), var(--danger));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--secondary);
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .tab-btn {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            color: var(--dark);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .tab-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-btn.active::after {
            width: 100%;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
            transition: transform 0.3s ease;
        }

        .table-container:hover {
            transform: translateY(-5px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        .gold-row {
            background-color: rgba(255, 215, 0, 0.1) !important;
            font-weight: bold;
        }

        .silver-row {
            background-color: rgba(192, 192, 192, 0.1) !important;
            font-weight: bold;
        }

        .bronze-row {
            background-color: rgba(205, 127, 50, 0.1) !important;
            font-weight: bold;
        }

        .locked-message {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        .locked-message h2 {
            color: var(--danger);
            margin-bottom: 15px;
        }

        .countdown {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-top: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-locked {
            background-color: var(--danger);
            color: white;
        }

        .status-unlocked {
            background-color: var(--success);
            color: white;
        }

        .edit-btn {
            background: var(--warning);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .edit-btn:hover {
            background: #e07d0e;
            transform: scale(1.05);
        }

        .delete-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 5px;
        }

        .delete-btn:hover {
            background: #e3126e;
            transform: scale(1.05);
        }

        .save-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: none;
        }

        .save-btn:hover {
            background: #3aa8d8;
            transform: scale(1.05);
        }

        .add-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .add-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
            width: 80%;
            max-width: 600px;
            animation: slideDown 0.4s ease;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            color: #aaa;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            color: var(--danger);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            outline: none;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 50px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            outline: none;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 50px;
            font-size: 0.9rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .filter-select:focus {
            border-color: var(--primary);
            outline: none;
        }

        .team-members {
            text-align: left;
            max-width: 300px;
            margin: 0 auto;
        }

        .team-member {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .team-member:last-child {
            border-bottom: none;
        }

        .member-id {
            font-weight: bold;
            color: var(--primary);
        }

        .member-points {
            float: right;
            color: var(--success);
            font-weight: bold;
        }

        .team-details-toggle {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .team-details-toggle:hover {
            color: var(--secondary);
            transform: scale(1.1);
        }

        .team-details {
            display: none;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .team-details.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(247, 37, 133, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(247, 37, 133, 0); }
            100% { box-shadow: 0 0 0 0 rgba(247, 37, 133, 0); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .trophy-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }

        .gold-icon {
            color: var(--gold);
        }

        .silver-icon {
            color: var(--silver);
        }

        .bronze-icon {
            color: var(--bronze);
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            th, td {
                padding: 10px 5px;
                font-size: 0.9rem;
            }
            
            .team-members {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Tournament Scrimbase ID</h1>
            <p class="subtitle">Battle of the best teams - Season 1 - Wave 2</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="teams">All Teams</button>
            <button class="tab-btn" data-tab="final">Final Top 15</button>
        </div>

        <div id="teams" class="tab-content active">
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search by Team Name...">
                <div class="filter-group">
                    <select id="groupFilter" class="filter-select">
                        <option value="all">All Groups</option>
                        <option value="A">Group A</option>
                        <option value="B">Group B</option>
                    </select>
                    <select id="sortBy" class="filter-select">
                        <option value="point-desc">Sort by: Points (High to Low)</option>
                        <option value="point-asc">Sort by: Points (Low to High)</option>
                        <option value="name">Sort by: Team Name</option>
                    </select>
                </div>
            </div>
            <button id="addTeamBtn" class="add-btn">+ Add New Team</button>
            <div class="table-container">
                <table id="teamsTable">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Team Name</th>
                            <th>Total Points</th>
                            <th>Avg Points</th>
                            <th>Group</th>
                            <th>Members</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="teamsBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
            <button id="saveAllBtn" class="save-btn">Save All Changes</button>
        </div>

        <div id="final" class="tab-content">
            <div id="lockedMessage" class="locked-message">
                <div class="trophy-icon">🔒</div>
                <h2>Final Leaderboard Locked</h2>
                <p>The final top 20 team leaderboard will be automatically unlocked on June 8, 2025 at 12:00 WIB</p>
                <div class="countdown" id="countdown"></div>
                <p>Current status: <span class="status-badge status-locked">Locked</span></p>
            </div>
            <div class="table-container" id="finalTableContainer" style="display: none;">
                <table id="finalTable">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Team Name</th>
                            <th>Total Points</th>
                            <th>Avg Points</th>
                            <th>Original Group</th>
                            <th>Members</th>
                        </tr>
                    </thead>
                    <tbody id="finalBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="footer">
            <p>© 2025 Scrimbase ID | All rights reserved</p>
        </div>
    </div>

    <!-- Modal Edit Team -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="modalTitle">Edit Team</h2>
            <form id="editForm">
                <div class="form-group">
                    <label for="editId">Team ID</label>
                    <input type="text" id="editId" readonly>
                </div>
                <div class="form-group">
                    <label for="editTeamName">Team Name</label>
                    <input type="text" id="editTeamName" required>
                </div>
                <div class="form-group">
                    <label for="editGroup">Group</label>
                    <select id="editGroup" required>
                        <option value="A">Group A</option>
                        <option value="B">Group B</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editMembers">Team Members (Format: ID Game|Nickname|Points, satu anggota per baris)</label>
                    <textarea id="editMembers" rows="5" required></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelEdit">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Confirm Delete -->
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close-btn">&times;</span>
            <h2>Confirm Delete</h2>
            <p>Are you sure you want to delete this team?</p>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelDelete">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>

    <script>
        // Data JSON untuk tim
        const tournamentData = {
            "teams": [
    {
        "id": 1,
        "name": "DARKLUNA GLOOMY",
        "group": "A",
        "members": [
            {"id_game": "586013048798", "nickname": "ᴰᴸ✗Holyz'4", "point": 0},
            {"id_game": "313296215817", "nickname": "ᴰᴸ✗Rhyme'4", "point": 0},
            {"id_game": "313294599297", "nickname": "ᴰᴸ✗Daff'4", "point": 0},
            {"id_game": "586022404625", "nickname": "ᴰᴸ✗Drey'4", "point": 0}
        ]
    },
    {
        "id": 2,
        "name": "DARKLUNA SUPERNOVA",
        "group": "A",
        "members": [
            {"id_game": "586014138871", "nickname": "ᴰᴸ✗C`NV", "point": 0},
            {"id_game": "586019950422", "nickname": "ᴰᴸ✗W`NV", "point": 0},
            {"id_game": "586013048734", "nickname": "ᴰᴸ✗G`NV", "point": 0},
            {"id_game": "588167798747", "nickname": "ᴰᴸ✗V`NV", "point": 0}
        ]
    },
    {
        "id": 3,
        "name": "CFJJ",
        "group": "A",
        "members": [
            {"id_game": "586017735709", "nickname": "ryterzo", "point": 0},
            {"id_game": "588162925307", "nickname": "wenprime", "point": 0},
            {"id_game": "588174059993", "nickname": "PAHAM!", "point": 0},
            {"id_game": "588170237503", "nickname": "aresen", "point": 0}
        ]
    },
    {
        "id": 4,
        "name": "2 RECKLESS",
        "group": "A",
        "members": [
            {"id_game": "586018373084", "nickname": "GLxDobby`2R", "point": 0},
            {"id_game": "586026553126", "nickname": "GLxPeks`2R", "point": 0},
            {"id_game": "586024908295", "nickname": "GLxItaa`2R", "point": 0},
            {"id_game": "586022768664", "nickname": "GLxVega`2R", "point": 0}
        ]
    },
    {
        "id": 5,
        "name": "BLACK•BLOOD",
        "group": "A",
        "members": [
            {"id_game": "586020789716", "nickname": "B•B|.FIAN.|", "point": 0},
            {"id_game": "586013449593", "nickname": "Will'NAKANO", "point": 0},
            {"id_game": "586018090906", "nickname": "B•B|FACE", "point": 0},
            {"id_game": "586020813447", "nickname": "B•B|·HAM·|", "point": 0}
        ]
    },
    {
        "id": 6,
        "name": "Decyc",
        "group": "A",
        "members": [
            {"id_game": "313287975629", "nickname": "I P • C h e l 80ss", "point": 0},
            {"id_game": "586021114051", "nickname": "N-¥ L i n n", "point": 0},
            {"id_game": "310065178866", "nickname": "Decyc_alif", "point": 0},
            {"id_game": "310074173307", "nickname": "Luficer", "point": 0}
        ]
    },
    {
        "id": 7,
        "name": "𝟏𝐌𝐀𝐍𝐒𝐐𝐔𝐀𝐃",
        "group": "A",
        "members": [
            {"id_game": "310067795363", "nickname": "1MS•Shadow", "point": 0},
            {"id_game": "586019871358", "nickname": "1MS•Draxen", "point": 0},
            {"id_game": "586016623895", "nickname": "1MS•Kenzaa", "point": 0},
            {"id_game": "586012250466", "nickname": "1MS•Shibal", "point": 0}
        ]
    },
    {
        "id": 8,
        "name": "San Fortress",
        "group": "A",
        "members": [
            {"id_game": "313288354535", "nickname": "𝙎𝙁/CECEP", "point": 0},
            {"id_game": "313296542290", "nickname": "SF/Ichl-upm", "point": 0},
            {"id_game": "586026203614", "nickname": "-1AzureShop", "point": 0},
            {"id_game": "586020733384", "nickname": "softboy™", "point": 0}
        ]
    },
    {
        "id": 9,
        "name": "EAGLE TEAM",
        "group": "A",
        "members": [
            {"id_game": "586011420721", "nickname": "Crazy ID💀", "point": 0},
            {"id_game": "31329855430", "nickname": "Suryazz", "point": 0},
            {"id_game": "31329855430", "nickname": "indev.rss 🗿", "point": 0},
            {"id_game": "584945021197", "nickname": "T E N K A HD", "point": 0}
        ]
    },
    {
        "id": 10,
        "name": "The diddlers",
        "group": "A",
        "members": [
            {"id_game": "859817715688", "nickname": "★ 𝓟𝓮𝓻𝓵𝓱𝓪𝓶 ★", "point": 0},
            {"id_game": "588164637033", "nickname": "lucifer", "point": 0},
            {"id_game": "586013210755", "nickname": "[CB]-Rezola", "point": 0},
            {"id_game": "584941924194", "nickname": "zenskie💤", "point": 0}
        ]
    },
    {
        "id": 11,
        "name": "SKN2",
        "group": "A",
        "members": [
            {"id_game": "586012745913", "nickname": "SKN2°`Reii", "point": 0},
            {"id_game": "313282859206", "nickname": "SKN2°`Falzz", "point": 0},
            {"id_game": "310064567803", "nickname": "SKN2°`Reyyy.", "point": 0},
            {"id_game": "586017628123", "nickname": "SKN2°`jelool", "point": 0}
        ]
    }
],
            "final": {
                "status": "locked",
                "unlock_at": "2025-09-21T12:00:00",
                "top_20": [],
                "highlight_top": {
                    "1": "#FFD700",
                    "2": "#C0C0C0",
                    "3": "#CD7F32"
                }
            }
        };

        // DOM Elements
        const teamsBody = document.getElementById('teamsBody');
        const finalBody = document.getElementById('finalBody');
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const searchInput = document.getElementById('searchInput');
        const groupFilter = document.getElementById('groupFilter');
        const sortBy = document.getElementById('sortBy');
        const lockedMessage = document.getElementById('lockedMessage');
        const finalTableContainer = document.getElementById('finalTableContainer');
        const countdownElement = document.getElementById('countdown');
        const editModal = document.getElementById('editModal');
        const deleteModal = document.getElementById('deleteModal');
        const closeBtns = document.querySelectorAll('.close-btn');
        const cancelEditBtn = document.getElementById('cancelEdit');
        const cancelDeleteBtn = document.getElementById('cancelDelete');
        const confirmDeleteBtn = document.getElementById('confirmDelete');
        const editForm = document.getElementById('editForm');
        const saveAllBtn = document.getElementById('saveAllBtn');
        const addTeamBtn = document.getElementById('addTeamBtn');
        const modalTitle = document.getElementById('modalTitle');

        // Variables
        let currentEditId = null;
        let isFinalUnlocked = false;
        let isAddingNew = false;
        let teamsData = [...tournamentData.teams];
        let originalData = [...tournamentData.teams];

        // Fungsi untuk menghitung total dan rata-rata poin tim
        function calculateTeamStats(team) {
            const totalPoints = team.members.reduce((sum, member) => sum + member.point, 0);
            const avgPoints = totalPoints / team.members.length;
            return { totalPoints, avgPoints: avgPoints.toFixed(2) };
        }

        // Render teams table
        function renderTeamsTable(filter = '', group = 'all', sortOption = 'point-desc') {
            teamsBody.innerHTML = '';
            
            let filteredData = [...teamsData];
            
            // Apply filters
            if (filter) {
                const lowerFilter = filter.toLowerCase();
                filteredData = filteredData.filter(team => 
                    team.name.toLowerCase().includes(lowerFilter)
                );
            }
            
            if (group !== 'all') {
                filteredData = filteredData.filter(team => team.group === group);
            }
            
            // Calculate stats for each team
            const teamsWithStats = filteredData.map(team => {
                const { totalPoints, avgPoints } = calculateTeamStats(team);
                return { ...team, totalPoints, avgPoints };
            });
            
            // Apply sorting
            switch (sortOption) {
                case 'point-asc':
                    teamsWithStats.sort((a, b) => a.totalPoints - b.totalPoints);
                    break;
                case 'point-desc':
                    teamsWithStats.sort((a, b) => b.totalPoints - a.totalPoints);
                    break;
                case 'name':
                    teamsWithStats.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                default:
                    teamsWithStats.sort((a, b) => b.totalPoints - a.totalPoints);
            }
            
            // Render rows
            teamsWithStats.forEach((team, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${team.name}</td>
                    <td>${team.totalPoints}</td>
                    <td>${team.avgPoints}</td>
                    <td>${team.group}</td>
                    <td>
                        <button class="team-details-toggle" data-id="${team.id}">👥</button>
                        <div class="team-details" id="team-${team.id}">
                            <div class="team-members">
                                ${team.members.map(member => `
                                    <div class="team-member">
                                        <span class="member-id">${member.id_game}</span><br>
                                        <span>${member.nickname}</span>
                                        <span class="member-points">${member.point} pts</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </td>
                    <td>
                        <button class="edit-btn" data-id="${team.id}">Edit</button>
                        <button class="delete-btn" data-id="${team.id}">Delete</button>
                    </td>
                `;
                teamsBody.appendChild(row);
            });
            
            // Add event listeners to toggle buttons
            document.querySelectorAll('.team-details-toggle').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const details = document.getElementById(`team-${id}`);
                    details.classList.toggle('active');
                });
            });
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.getAttribute('data-id'));
                    openEditModal(id);
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.getAttribute('data-id'));
                    openDeleteModal(id);
                });
            });
            
            // Show/hide save button based on changes
            const hasChanges = JSON.stringify(teamsData) !== JSON.stringify(originalData);
            saveAllBtn.style.display = hasChanges ? 'inline-block' : 'none';
        }

        // Render final table
        function renderFinalTable() {
            finalBody.innerHTML = '';
            
            // Get top 20 teams
            const top20 = [...teamsData]
                .map(team => {
                    const { totalPoints, avgPoints } = calculateTeamStats(team);
                    return { ...team, totalPoints, avgPoints };
                })
                .sort((a, b) => b.totalPoints - a.totalPoints)
                .slice(0, 20);
            
            tournamentData.final.top_20 = top20;
            
            // Render rows
            top20.forEach((team, index) => {
                const row = document.createElement('tr');
                const rank = index + 1;
                
                // Add special class for top 3
                if (rank === 1) {
                    row.classList.add('gold-row');
                } else if (rank === 2) {
                    row.classList.add('silver-row');
                } else if (rank === 3) {
                    row.classList.add('bronze-row');
                }
                
                row.innerHTML = `
                    <td>${rank}</td>
                    <td>${team.name}</td>
                    <td>${team.totalPoints}</td>
                    <td>${team.avgPoints}</td>
                    <td>${team.group}</td>
                    <td>
                        <button class="team-details-toggle" data-id="final-${team.id}">👥</button>
                        <div class="team-details" id="team-final-${team.id}">
                            <div class="team-members">
                                ${team.members.map(member => `
                                    <div class="team-member">
                                        <span class="member-id">${member.id_game}</span><br>
                                        <span>${member.nickname}</span>
                                        <span class="member-points">${member.point} pts</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </td>
                `;
                finalBody.appendChild(row);
            });
            
            // Add event listeners to toggle buttons
            document.querySelectorAll('.team-details-toggle').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const details = document.getElementById(`team-${id}`);
                    details.classList.toggle('active');
                });
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Tab switching
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    tabBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const tabId = btn.getAttribute('data-tab');
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Search and filter
            searchInput.addEventListener('input', (e) => {
                renderTeamsTable(e.target.value, groupFilter.value, sortBy.value);
            });
            
            groupFilter.addEventListener('change', () => {
                renderTeamsTable(searchInput.value, groupFilter.value, sortBy.value);
            });
            
            sortBy.addEventListener('change', () => {
                renderTeamsTable(searchInput.value, groupFilter.value, sortBy.value);
            });
            
            // Modal events
            closeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    editModal.style.display = 'none';
                    deleteModal.style.display = 'none';
                });
            });
            
            cancelEditBtn.addEventListener('click', () => {
                editModal.style.display = 'none';
            });
            
            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.style.display = 'none';
            });
            
            editForm.addEventListener('submit', saveEdit);
            
            confirmDeleteBtn.addEventListener('click', confirmDelete);
            
            // Save all changes
            saveAllBtn.addEventListener('click', saveAllChanges);
            
            // Add new team
            addTeamBtn.addEventListener('click', addNewTeam);
            
            // Click outside modal to close
            window.addEventListener('click', (e) => {
                if (e.target === editModal) {
                    editModal.style.display = 'none';
                }
                if (e.target === deleteModal) {
                    deleteModal.style.display = 'none';
                }
            });
        }

        // Open edit modal
        function openEditModal(id) {
            const team = teamsData.find(t => t.id === id);
            if (!team) return;
            
            isAddingNew = false;
            currentEditId = id;
            modalTitle.textContent = 'Edit Team';
            document.getElementById('editId').value = team.id;
            document.getElementById('editTeamName').value = team.name;
            document.getElementById('editGroup').value = team.group;
            
            // Format members for textarea
            const membersText = team.members.map(m => 
                `${m.id_game}|${m.nickname}|${m.point}`
            ).join('\n');
            
            document.getElementById('editMembers').value = membersText;
            
            editModal.style.display = 'block';
        }

        // Open delete modal
        function openDeleteModal(id) {
            currentEditId = id;
            deleteModal.style.display = 'block';
        }

        // Add new team
        function addNewTeam() {
            isAddingNew = true;
            currentEditId = null;
            modalTitle.textContent = 'Add New Team';
            
            // Generate new ID
            const newId = teamsData.length > 0 ? 
                Math.max(...teamsData.map(t => t.id)) + 1 : 1;
            
            document.getElementById('editId').value = newId;
            document.getElementById('editTeamName').value = '';
            document.getElementById('editGroup').value = 'A';
            document.getElementById('editMembers').value = '';
            
            editModal.style.display = 'block';
        }

        // Save edit or add new team
        function saveEdit(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('editId').value);
            const name = document.getElementById('editTeamName').value;
            const group = document.getElementById('editGroup').value;
            const membersText = document.getElementById('editMembers').value;
            
            // Parse members from text
            const members = membersText.split('\n')
                .filter(line => line.trim())
                .map(line => {
                    const parts = line.split('|');
                    return {
                        id_game: parts[0] || '',
                        nickname: parts[1] || '',
                        point: parseInt(parts[2]) || 0
                    };
                });
            
            if (isAddingNew) {
                // Add new team
                const newTeam = {
                    id,
                    name,
                    group,
                    members
                };
                
                teamsData.push(newTeam);
            } else {
                // Update existing team
                const teamIndex = teamsData.findIndex(t => t.id === currentEditId);
                if (teamIndex === -1) return;
                
                teamsData[teamIndex] = {
                    ...teamsData[teamIndex],
                    name: name,
                    group: group,
                    members: members
                };
            }
            
            // Re-render tables
            renderTeamsTable(searchInput.value, groupFilter.value, sortBy.value);
            
            if (isFinalUnlocked) {
                renderFinalTable();
            }
            
            editModal.style.display = 'none';
        }

        // Confirm delete
        function confirmDelete() {
            const teamIndex = teamsData.findIndex(t => t.id === currentEditId);
            if (teamIndex === -1) return;
            
            teamsData.splice(teamIndex, 1);
            
            // Re-render tables
            renderTeamsTable(searchInput.value, groupFilter.value, sortBy.value);
            
            if (isFinalUnlocked) {
                renderFinalTable();
            }
            
            deleteModal.style.display = 'none';
        }

        // Save all changes
        function saveAllChanges() {
            // In a real app, you would send the data to a server here
            originalData = [...teamsData];
            saveAllBtn.style.display = 'none';
            alert('All changes saved successfully!');
            
            // If final is unlocked, re-render it
            if (isFinalUnlocked) {
                renderFinalTable();
            }
        }

        // Check final status
        function checkFinalStatus() {
            const unlockAt = new Date(tournamentData.final.unlock_at);
            const now = new Date();
            
            if (now >= unlockAt) {
                isFinalUnlocked = true;
                tournamentData.final.status = 'unlocked';
                lockedMessage.style.display = 'none';
                finalTableContainer.style.display = 'block';
                renderFinalTable();
                
                // Update status badge
                const statusBadge = document.querySelector('.status-badge');
                if (statusBadge) {
                    statusBadge.classList.remove('status-locked');
                    statusBadge.classList.add('status-unlocked');
                    statusBadge.textContent = 'Unlocked';
                }
            }
        }

        // Start countdown
        function startCountdown() {
            const unlockAt = new Date(tournamentData.final.unlock_at);
            
            function updateCountdown() {
                const now = new Date();
                const diff = unlockAt - now;
                
                if (diff <= 0) {
                    countdownElement.textContent = 'Final leaderboard is now available!';
                    checkFinalStatus();
                    return;
                }
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                countdownElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        // Initialize the app
        function init() {
            renderTeamsTable();
            setupEventListeners();
            checkFinalStatus();
            startCountdown();
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>